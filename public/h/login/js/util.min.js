/*!
 * Portal.js
 * URL:http://www.faisco.com
 * Only for Guest mode
 * Sort as
 * 		Utils/ModuleFunction/Other Global InitFunction
 * Sort time @2011-10-22
 * Partition time @2012-05-16
 */
if(typeof Portal=="undefined"){Portal={}}Portal.genAjaxUrl=function(b){var a="";if(document.location.pathname.indexOf("/manage/")>=0){a="../ajax/"}else{a="ajax/"}return a+b};Portal.popupWindow=function(a){var b=true;if(!Fai.isNull(a.saveBeforePopup)){b=a.saveBeforePopup}if(b&&Portal.checkSaveBar()){return}if($.isFunction(Portal.removeAllEditLayer)){Portal.removeAllEditLayer()}Fai.popupWindow(a)};Portal.logMsg=function(c){if(!c){return}var b="";var a=c.indexOf("&");if(a>=0){b=c.slice(a,c.length-1)}$.ajax({type:"GET",url:"/ajax/log_h.jsp?cmd=log&msg="+Fai.encodeUrl(c),data:b})};Portal.logDog=function(b,a){$.ajax({type:"GET",url:"/ajax/log_h.jsp?cmd=dog&dogId="+Fai.encodeUrl(b)+"&dogSrc="+Fai.encodeUrl(a)})};Portal.logStayDog=function(e,a,d){if(d<30000){return}var c=$.cookie("stayDogIntervalId"+e+"-"+a);if(c!=null){clearInterval(c)}$.ajax({type:"GET",url:"/ajax/log_h.jsp?cmd=stayDog&dogId="+Fai.encodeUrl(e)+"&dogSrc="+Fai.encodeUrl(a)});var b=setInterval(function(){$.ajax({type:"GET",url:"/ajax/log_h.jsp?cmd=stayDog&dogId="+Fai.encodeUrl(e)+"&dogSrc="+Fai.encodeUrl(a)})},d);$.cookie("stayDogIntervalId"+e+"-"+a,b)};Portal.logProf=function(b,a){$.ajax({type:"GET",url:"/ajax/log_h.jsp?cmd=prof&profId="+Fai.encodeUrl(b)+"&profVal="+Fai.encodeUrl(a)})};Portal.popupBox=function(n){var e={boxId:0,title:"",htmlContent:"",width:500,opacity:"0.5",displayBg:true};e=$.extend(e,n);var a=parseInt(e.boxId);if(a==0||a==null){a=parseInt(Math.random()*10000)}if(e.displayBg){Fai.bg(a,e.opacity)}var l="";if(e.height!=null){l=" height:"+e.height+"px;"}var d=["<div id='popupBoxContent",a,"' style='width:",e.width,"px;",l,"' class='popupCnBg'>",e.htmlContent,"</div>"];var h=Fai.top.document.documentElement.clientHeight;var c=Fai.top.$("body").scrollTop();if(c<=0){c=Fai.top.$("html").scrollTop()}if(c<=0){c=$(window).scrollTop()}var k=["<div id='popupBox",a,"' class='formBox' style='width:",e.width,"px;left:",(Fai.top.document.documentElement.clientWidth-e.width)/2,"px;'>","<div class='formTLPortal'><div class='formTCPortal ",e.title==""?"formMulLanPortal":"","'>",e.title,"</div></div>","<div class='formMSG' style='position:relative;'>",d.join(""),"</div>","<a href='javascript:void(0);' class='formXPortal popupBClose' hidefocus='true' onclick='return false;'></a>","</div>"];k=k.join("");var j=Fai.top.$(k).appendTo("body");var i=(h-e.height)/2;if(e.height==null){i=(h-$(".popupCnBg").height())/2}$(j).css("top",i+c);var g=Fai.top.$("#popupBg"+a).outerHeight(true),f=Fai.top.$("#popupBoxContent"+a).outerHeight(true)+120,m=100-(f-g)>0?100-(f-g):0;if(g<f){j.css("top",m+"px")}function b(o){return Object.prototype.toString.call(o)==="[object Function]"}j.ready(function(){j.draggable({start:function(){Fai.top.$("body").disableSelection()},handle:".formTLPortal",stop:function(){Fai.top.$("body").enableSelection()}});j.find(".popupBClose").bind("click",function(){if(b(e.closeFunc)){e.closeFunc()}Fai.top.$("#popupBg"+a).remove();j.remove()})});return j};Portal.checkEnv=function(){var h=$(window).width();h=h-17;var k=[];var d=function(n){if($(n).attr("_intab")>0||$(n).attr("_inmulmcol")>0||$(n).attr("_side")==1){return}var r=$(n).offset().left;var q=$(n).width();var u=$(n).prop("id");var s=false;if(r<0){s=true}if(!s&&(r+q)>h){s=true}if(s){k.push(u)}};Fai.top.$(".absForms >.form").each(function(q,n){d(n)});Fai.top.$(".floatForms >.form").each(function(q,n){d(n)});var o="";if(k.length>0){o+="--网站浮动模块位置；\n"}$.each(k,function(q,n){$("#"+n).css("border","dashed black 5px")});var p=$("#logoImg");var g=p.width();var m=p.offset().left;if(m<0||(m+g)>h){o+="--网站LOGO的宽度或位置；\n"}var c=$("#primaryTitle");var b=c.width();var i=c.offset().left;if(i<0||(i+b)>h){o+="--网站标题宽度或位置；\n"}var e=$("#nav");var j=e.width();var a=e.offset().left;if((a+j)>h){o+="--导航栏宽度或位置。；\n"}var f=$("#webContainer").width();if(f>h){o+="--网站背景宽度；\n"}var l=$(".webBanner").width();if(l>h){o+="--网站横幅宽度；\n"}if($("#webHeader").width()>h){o+="--网站头部宽度；\n"}o=$.trim(o);if(o.length>0){o="窗口宽度："+h+"；\n导致模块滚动条出现的原因：\n"+o;alert(o)}else{alert("没有检测到横向超出的元素。")}};Portal.floatTip=function(d){var q={moduleId:"",targetId:"",tipText:"",cusClass:"",direction:3};q=$.extend(q,d);if(q.moduleId.length==0||q.targetId.length==0||q.tipText.length==0){return}$(Fai.top.document).find(".J_floatTip_"+q.moduleId).remove();var k=Fai.isIE6()||Fai.isIE7()||Fai.isIE8();var t=[];var j="floatTip_content";var r="floatTip_right";var l="floatTip_arrow";var p="floatTip_left";var o="floatTip_"+q.moduleId+"_"+q.targetId;if(k){j+=" floatTip_content_IE ";r+=" floatTip_right_IE ";l+=" floatTip_arrow_IE ";p+=" floatTip_left_IE "}t.push("<div id='"+o+"' class='J_floatTip_"+q.moduleId+" floatTip'>\n");t.push("<div class='"+l+"'></div>");t.push("<div class='"+r+"'></div>");t.push("<div class='"+p+"'></div>");t.push("<div class='"+j+q.cusClass+"'>"+q.tipText+"</div>");t.push("</div>\n");$(Fai.top.document).find("#g_main").append(t.join(""));var b=$("#"+q.moduleId);var s=$(b).find("#"+q.targetId);var a=$("#"+o);var h=$(".floatLeftTop").offset().top;var c=(Fai.top._manageMode)?$("#g_main").scrollTop():$("body").scrollTop();if(Fai.isIE6()){c=$("#g_main").scrollTop()}if(c==0){c=$("html").scrollTop()}var e=a.height();var m=a.width()*0.7;var g=s.width()*0.8;var f=s.height();var n=s.offset().left+(g-m);var i=s.offset().top+c-h;$("#"+o).show().css({top:i+"px",left:n+"px","z-index":9031});setTimeout(function(){if(k){var u=i-e-10+(f/3);$("#"+o).animate({top:u+"px",opacity:1,filter:"alpha(opacity=100)"},300)}else{var u=i-e+(f/3);$("#"+o).css({top:u+"px",opacity:1})}},50);$(s).unbind("click").bind("click",function(){if($(this).hasClass("focusBg")){$(this).removeClass("focusBg")}$("#floatTip_"+q.moduleId+"_"+q.targetId).remove()})};Portal.floatTip_clear=function(a){$(Fai.top.document).find(".J_floatTip_"+a).remove()};